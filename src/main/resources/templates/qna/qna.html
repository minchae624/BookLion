<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>책 먹는 사자 - Q&A</title>
  <link rel="stylesheet" href="/css/style.css" />
</head>

<body>
  <header class="home-header">
    <a href="/">
      <img src="/img/linklogo.png" alt="홈으로" class="linklogo">
    </a>
    <div class="home-user-info">
		<span id="welcome-msg">환영합니다.</span>
		<script th:src="@{/js/frontshared.js}"></script>

      <div class="home-nav-buttons">
        <a href="/logout" class="btn btn-secondary">로그아웃</a>
        <a href="/mypage" class="btn btn-secondary">마이페이지</a>
      </div>
    </div>
  </header>

  <main class="mypage-container">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
      <h3>Q&A 목록</h3>
      <a th:href="@{/questions/write}" class="btn btn-blue">질문하기</a>
    </div>

    <table style="width: 100%; border-collapse: collapse; margin-top: 1rem;">
      <thead>
        <tr style="border-bottom: 2px solid #ccc;">
          <th>번호</th>
          <th>카테고리</th>
          <th>제목</th>
          <th>작성자</th>
          <th>작성일</th>
          <th>상태</th>
          <th>조회수</th>
          <th>좋아요</th>
        </tr>
      </thead>
      <tbody id="question-list">
        <tr th:each="q, stat : ${questions}" style="text-align: center;">
          <td th:text="${stat.count}">1</td>
          <td th:text="${q.category}">카테고리</td>
          <td>
            <a th:href="@{/questions/{id}(id=${q.id})}" th:text="${q.title}" style="text-decoration: none; color: #333;">제목</a>
          </td>
          <td th:text="${q.user?.username}">작성자</td>
          <td th:text="${#temporals.format(q.writingtime, 'yyyy-MM-dd')}">작성일</td>
          <td th:text="${q.status == 'SOLVED' ? '해결' : '미해결'}"
              th:style="${q.status == 'SOLVED'} ? 'color:green' : 'color:red'">상태</td>
          <td th:text="${q.viewCount}">0</td>
          <td th:text="${q.likeCount}">0</td>
        </tr>
      </tbody>
    </table>
  </main>
  <script>
	document.addEventListener("DOMContentLoaded", () => {
	  fetch("/questions")
	    .then(res => res.json())
	    .then(data => {
	      const tbody = document.getElementById("question-list");
	      tbody.innerHTML = "";
	      data.forEach((q, idx) => {
	        const row = document.createElement("tr");
	        row.innerHTML = `
	          <td>${idx + 1}</td>
	          <td>${q.category?.category || "-"}</td>
	          <td><a href="qna_detail.html?id=${q.questId}">${q.title}</a></td>
	          <td>${q.user?.username || "-"}</td>
	          <td>${q.writingtime?.substring(0, 10) || "-"}</td>
	          <td>${q.status === "SOLVED" ? "해결" : "미해결"}</td>
	          <td>${q.viewCount}</td>
	          <td>${q.likeCount}</td>
	        `;
	        tbody.appendChild(row);
	      });
	    });
	});

  </script>
</body>

</html>
